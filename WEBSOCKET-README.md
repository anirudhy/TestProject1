# WebSocket-Based Word Add-in

A **headless** Word add-in that maintains a persistent WebSocket connection to your backend server, allowing you to execute Word.js API commands remotely.

## Features

‚úÖ **Invisible UI** - Task pane is hidden (0x0 pixels, positioned off-screen)
‚úÖ **Persistent WebSocket** - Maintains connection to your backend
‚úÖ **Auto-reconnect** - Automatically reconnects if connection drops
‚úÖ **Remote Command Execution** - Execute Word.js APIs from your backend
‚úÖ **Auto-open** - Starts automatically when document opens

## Architecture

```
Your Backend (WebSocket Server)
         ‚Üì
    WebSocket Connection
         ‚Üì
  Word Add-in (Hidden)
         ‚Üì
   Word.js API Calls
         ‚Üì
    Word Document
```

## Setup

### 1. Update WebSocket URL

Edit `websocket.html` line 28:

```javascript
const wsUrl = 'wss://your-backend.com/ws';  // Replace with your WebSocket server
```

### 2. Add Backend Domain to Manifest

Edit `manifest-websocket.xml` line 18:

```xml
<AppDomain>https://your-backend.com</AppDomain>
```

### 3. Deploy

```bash
git add websocket.html manifest-websocket.xml
git commit -m "Configure WebSocket backend"
git push
```

### 4. Upload Manifest

Download and upload to Word:
`https://anirudhy.github.io/TestProject1/manifest-websocket.xml`

## Backend Message Format

Your WebSocket server sends JSON commands to the add-in:

### Command Types

#### 1. Insert Text
```json
{
  "type": "insertText",
  "text": "Hello from backend!"
}
```

#### 2. Execute Word.js API Code
```json
{
  "type": "executeWordAPI",
  "code": "Word.run(async (context) => { const paragraph = context.document.body.insertParagraph('New paragraph', Word.InsertLocation.end); await context.sync(); });"
}
```

#### 3. Replace Text
```json
{
  "type": "replaceText",
  "search": "old text",
  "replace": "new text"
}
```

### Responses from Add-in

The add-in sends responses back to your server:

#### Success Response
```json
{
  "success": true,
  "action": "insertText"
}
```

#### Error Response
```json
{
  "success": false,
  "error": "Permission denied"
}
```

## Example Backend (Node.js)

```javascript
const WebSocket = require('ws');
const wss = new WebSocket.Server({ port: 8080 });

wss.on('connection', (ws) => {
  console.log('Word add-in connected');

  // Send a command to insert text
  ws.send(JSON.stringify({
    type: 'insertText',
    text: 'üéâ Connected to backend!'
  }));

  // Execute complex Word API operations
  ws.send(JSON.stringify({
    type: 'executeWordAPI',
    code: `
      Word.run(async (context) => {
        const body = context.document.body;
        body.insertParagraph('Generated by backend', Word.InsertLocation.end);
        await context.sync();
      });
    `
  }));

  // Handle responses from add-in
  ws.on('message', (data) => {
    const response = JSON.parse(data);
    console.log('Response from Word:', response);
  });
});
```

## How It Works

1. **Add-in loads** ‚Üí Creates invisible task pane (0x0, off-screen)
2. **WebSocket connects** ‚Üí Establishes connection to your backend
3. **Auto-enable auto-open** ‚Üí Sets itself to load automatically
4. **Listen for commands** ‚Üí Waits for JSON messages from backend
5. **Execute Word APIs** ‚Üí Runs commands and sends responses back
6. **Auto-reconnect** ‚Üí Reconnects if connection drops (every 5s)
7. **Heartbeat** ‚Üí Sends ping every 30s to keep connection alive

## Making It Truly Invisible

The task pane is styled to be invisible:

```css
body {
  width: 0;
  height: 0;
  overflow: hidden;
  position: absolute;
  left: -9999px;
}
```

**Note:** In Word on the web, the task pane may still show a minimal border. For a truly invisible experience, you might need to:

1. Use the task pane minimized (user can minimize it manually)
2. Or accept the minimal visual presence

## Security Considerations

‚ö†Ô∏è **Important:** The `executeWordAPI` command allows arbitrary code execution. Make sure to:

1. ‚úÖ Use **WSS** (secure WebSocket) in production
2. ‚úÖ Authenticate WebSocket connections
3. ‚úÖ Validate commands before execution
4. ‚úÖ Restrict which domains can connect (use CORS)
5. ‚úÖ Never expose your WebSocket endpoint publicly without auth

## Testing

1. Open Word on the web
2. Upload `manifest-websocket.xml`
3. Open task pane (first time only)
4. Check browser console: Should see "‚úÖ WebSocket connected"
5. Send commands from your backend
6. Commands execute in Word document!

## Troubleshooting

**Connection fails:**
- Check WebSocket URL is correct
- Ensure backend is running and accessible
- Check browser console for errors
- Verify domain is in `<AppDomains>` in manifest

**Task pane visible:**
- The CSS makes it nearly invisible, but Word may show a minimal border
- User can manually minimize the task pane if needed

**Auto-open not working:**
- Make sure you opened the task pane once manually
- Check that auto-open setting was saved (see console logs)

**Commands not executing:**
- Check JSON format is correct
- Verify `Word` object is available (Word.js API)
- Check browser console for errors
